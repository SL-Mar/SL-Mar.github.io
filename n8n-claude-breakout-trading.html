<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <meta name="description" content="Building an Automated Pre-Market Breakout Scanner with n8n and Claude Code - SL Mar R&D Notes">
    <title>Building an Automated Pre-Market Breakout Scanner with n8n and Claude Code | SL Mar</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .article-content {
            max-width: 900px;
            margin: 0 auto;
        }
        .article-content h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        .article-content h2 {
            font-size: 1.75rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }
        .article-content h3 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .article-content p {
            margin-bottom: 1rem;
            line-height: 1.8;
        }
        .article-content ul, .article-content ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }
        .article-content li {
            margin-bottom: 0.5rem;
        }
        .article-content code {
            background: var(--bg-secondary);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .article-content pre {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        .article-content pre code {
            padding: 0;
            background: none;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 2rem;
            color: var(--accent);
        }
    </style>
</head>
<body>
    <nav>
        <div class="container">
            <a href="index.html" class="logo">SL Mar</a>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="publications.html">Publications</a></li>
                <li><a href="development.html">Development</a></li>
                <li><a href="local-ai.html">Local AI</a></li>
                <li><a href="rnd-notes.html" class="active">R&D Notes</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </div>
    </nav>

    <section>
        <div class="container article-content">
            <a href="rnd-notes.html" class="back-link">← Back to R&D Notes</a>
            <h1>Building an Automated Pre-Market Breakout Scanner with n8n and Claude Code</h1><h2>How I Built a Fully Automated Trading System from Market Scanning to Live Execution</h2><p><strong>Date:</strong> October 6, 2025
<strong>Status:</strong> Draft
<strong>Target:</strong> Medium Publication</p><p>---</p><h2>Introduction</h2><p>In algorithmic trading, the challenge isn't just finding profitable patterns—it's automating the entire workflow from market scanning to live execution. In this article, I'll share how I built a complete end-to-end trading system that:</p><ul><li><strong>Scans</strong> tech sector stocks daily for pre-market breakout signals</li>
<li><strong>Analyzes</strong> technical indicators and assigns breakout scores</li>
<li><strong>Deploys</strong> the top candidates to a live trading algorithm automatically</li></ul><p>The system combines three powerful tools:
<li><strong>n8n</strong> - Workflow automation platform</li>
<li><strong>Claude Code</strong> - AI-powered development assistant</li>
<li><strong>QuantConnect</strong> - Algorithmic trading platform</li></ul><p>---</p><h2>Lesson 1: Connecting Claude Code with n8n MCP</h2><h3>The Integration Challenge</h3><p>Modern AI assistants like Claude are powerful, but they traditionally operate in isolation. The Model Context Protocol (MCP) changes this by allowing Claude to interact with external systems directly.</p><h3>What is n8n MCP?</h3><p>n8n MCP is a server that exposes n8n's workflow capabilities to Claude through a standardized protocol. This allows Claude to:
<li>Search and retrieve workflow templates</li>
<li>Create and modify workflows programmatically</li>
<li>Validate node configurations</li>
<li>Deploy and monitor automated processes</li></ul><h3>Setting Up the Connection</h3><p><strong>1. Install n8n MCP Server</strong></p><p>The n8n MCP server requires environment variables for API access:</p><pre><code>bash
export N8N_API_URL="http://localhost:5678"
export N8N_API_KEY="your-api-key"
</code></pre><p><strong>2. Configure Claude Code</strong></p><p>In your Claude Code configuration (<code>config.json</code>):</p><pre><code>json
{
  "mcpServers": {
    "n8n-mcp": {
      "command": "npx",
      "args": ["-y", "@n8n/mcp-server"],
      "env": {
        "N8N_API_URL": "http://localhost:5678",
        "N8N_API_KEY": "your-api-key"
      }
    }
  }
}
</code></pre><p><strong>3. Verify the Connection</strong></p><p>Ask Claude to check the connection:</p><pre><code>
"Check n8n-mcp server status and list my workflows"
</code></pre><p>Claude will execute:
<li><code>mcp__n8n-mcp__n8n_health_check()</code> - Verify API connectivity</li>
<li><code>mcp__n8n-mcp__n8n_list_workflows()</code> - List available workflows</li></ul><h3>Key Benefits</h3><p>✅ <strong>Programmatic Workflow Creation</strong> - Build complex n8n workflows through natural language
✅ <strong>Template Discovery</strong> - Search 2,500+ community templates programmatically
✅ <strong>Real-time Validation</strong> - Validate node configurations before deployment
✅ <strong>Error Recovery</strong> - Auto-fix common workflow errors</p><p>---</p><h2>Lesson 2: The Pre-Market Breakout Detection Methodology</h2><h3>The Breakout Signal Framework</h3><p>Technical breakouts occur when stocks break through resistance levels with strong momentum and volume. My methodology combines multiple signals into a weighted scoring system.</p><h3>Data Source: EODHD API</h3><p>Instead of trying to access Russell 3000 constituents directly (not available via API), I used EODHD's powerful screener endpoint:</p><pre><code>javascript
{
  "url": "https://eodhd.com/api/screener",
  "filters": [
    ["market_capitalization", ">", "300000000"],
    ["market_capitalization", "<", "50000000000"],
    ["exchange", "=", "us"],
    ["sector", "=", "technology"],
    ["avgvol_1d", ">", "1000000"]
  ]
}
</code></pre><p><strong>Filter Criteria:</strong>
<li><strong>Market Cap Range:</strong> $300M - $50B (mid to large caps)</li>
<li><strong>Exchange:</strong> US markets (NASDAQ/NYSE)</li>
<li><strong>Sector:</strong> Technology</li>
<li><strong>Volume Floor:</strong> >1M daily volume (liquidity requirement)</li></ul><h3>Volume Surge Detection (Critical Filter)</h3><p>The most important filter: <strong>3x volume surge</strong></p><pre><code>javascript
const filtered = stocks.filter(s =>
  s.avgvol_1d >= 3 * s.avgvol_200d
);
</code></pre><p>This identifies stocks where today's volume is <strong>at least 3x</strong> the 200-day average—a strong breakout confirmation signal.</p><h3>Technical Analysis Scoring System</h3><p>For each candidate stock, I calculate a composite score (0-100 points):</p><p><strong>1. Gap Analysis (30 points max)</strong>
<pre><code>javascript
const gapPercent = ((currentPrice - previousClose) / previousClose) * 100;</p><p>if (gapPercent > 5) score += 30;
else if (gapPercent > 3) score += 25;
else if (gapPercent > 2) score += 20;
else if (gapPercent > 1) score += 10;
</code></pre><p><strong>2. Volume Ratio (25 points max)</strong>
<pre><code>javascript
const volumeRatio = currentVolume / avgVolume_20day;</p><p>if (volumeRatio > 5) score += 25;
else if (volumeRatio > 3) score += 20;
else if (volumeRatio > 2) score += 15;
else if (volumeRatio > 1.5) score += 10;
</code></pre><p><strong>3. RSI Momentum (15 points max)</strong>
<pre><code>javascript
const rsiValue = calculateRSI(closes, 14);</p><p>if (rsiValue > 50 && rsiValue < 70) score += 15;
// Sweet spot: bullish but not overbought
</code></pre><p><strong>4. Breakout Quality (20 points max)</strong>
<pre><code>javascript
const resistance = Math.max(...highs.slice(-10)); // 10-day high</p><p>if (currentPrice > resistance) score += 20;
else if (distanceFromResistance > -2%) score += 10;
</code></pre><h3>The Selection Process</h3><p><strong>Step 1:</strong> Screener returns ~200 tech stocks
<strong>Step 2:</strong> Filter for 3x volume surge (~20-50 stocks)
<strong>Step 3:</strong> Calculate technical scores for each
<strong>Step 4:</strong> Select top 10 by score
<strong>Step 5:</strong> Store in Notion database (BREAKOUT SCORES)</p><h3>Why This Works</h3><ul><li><strong>Multi-Factor Validation:</strong> Combines price action, volume, momentum, and resistance</li>
<li><strong>Objective Scoring:</strong> Removes emotional bias from stock selection</li>
<li><strong>Adaptive Universe:</strong> Daily refresh catches new opportunities</li>
<li><strong>Risk Filtering:</strong> Volume and liquidity requirements reduce slippage</li></ul><p>---</p><h2>Lesson 3: The n8n Workflow Algorithm</h2><h3>Workflow Architecture</h3><p>The n8n workflow runs daily at 7:00 AM ET (1:00 PM CET) and executes the following sequence:</p><pre><code>
[Schedule Trigger]
    ↓
[Screener Parameters]
    ↓
[EODHD API Call]
    ↓
[3x Volume Filter]
    ↓
[Loop Through Stocks]
    ├→ [Real-Time Price Data]
    └→ [20-Day Historical Data]
    ↓
[Technical Scoring]
    ↓
[Chart Generation]
    ↓
[Store in Notion DB]
    ↓
[Query Database]
    ↓
[Extract Ticker List]
    ↓
[Generate QC Code]
    ↓
[Output: Python List]
</code></pre><h3>Key Technical Implementations</h3><p><strong>1. Schedule Trigger (Cron Expression)</strong>
<pre><code>json
{
  "cronExpression": "0 7 * * 1-5"
}
</code></pre>
<li>Runs Monday-Friday at 7 AM ET</li>
<li>Pre-market window (market opens 9:30 AM)</li></ul><p><strong>2. Split-in-Batches Pattern</strong>
<pre><code>json
{
  "type": "n8n-nodes-base.splitInBatches",
  "batchSize": 1
}
</code></pre>
<li>Processes each stock individually</li>
<li>Fetches real-time + historical data</li>
<li>Prevents API rate limiting</li></ul><p><strong>3. Merge Pattern for Data Combination</strong>
<pre><code>
[Real-Time Data] ──┐
                   ├─→ [Merge Node] ─→ [Technical Score]
[Historical Data] ─┘
</code></pre>
<li>Combines current price with 20-day history</li>
<li>Enables RSI and SMA calculations</li></ul><p><strong>4. Code Nodes for Complex Logic</strong></p><p>Technical scoring implemented in JavaScript:
<pre><code>javascript
function rsi(closes, period = 14) {
  let gains = 0, losses = 0;
  for (let i = closes.length - period; i < closes.length; i++) {
    const change = closes[i] - closes[i - 1];
    if (change > 0) gains += change;
    else losses -= change;
  }
  const rs = (gains / period) / (losses / period);
  return 100 - (100 / (1 + rs));
}
</code></pre><p><strong>5. Notion Database Integration</strong></p><p>Store results with full metadata:
<li>Ticker symbol</li>
<li>Technical score (0-100)</li>
<li>Current price</li>
<li>Chart URL</li>
<li>Technical signal summary</li></ul><p><strong>6. Final Output Generation</strong></p><p>Query Notion DB and extract ticker list:
<pre><code>javascript
const tickers = items
  .map(item => item.properties.Ticker?.title?.[0]?.plain_text)
  .filter(t => t !== null);</p><p>return [{ json: { python_list: JSON.stringify(tickers) } }];
</code></pre><h3>Error Handling & Resilience</h3><p><strong>Chart Generation Fallback:</strong>
<li>Chart workflow continues on error</li>
<li>Uses <code>onError: "continueErrorOutput"</code></li>
<li>Ensures main workflow completes</li></ul><p><strong>Volume Surge Safety:</strong>
<pre><code>javascript
const histArray = Array.isArray(hist) ? hist : [hist];
</code></pre>
<li>Handles API response variations</li>
<li>Prevents runtime failures</li></ul><h3>Output Format</h3><p>The workflow produces a clean Python-ready list:
<pre><code>json
[
  {
    "python_list": "[\"ONDS\", \"BSY\", \"CAN\", \"QUBT\", \"VERI\", \"NNDM\", \"IDCC\"]"
  }
]
</code></pre><p>Ready for immediate use in QuantConnect algorithms.</p><p>---</p><h2>Bringing It All Together</h2><h3>The Complete Automated Flow</h3><p><strong>Morning (7:00 AM ET):</strong>
<li>n8n workflow triggers automatically</li>
<li>Scans tech sector for volume surges</li>
<li>Scores stocks using technical indicators</li>
<li>Stores top 10 in Notion database</li>
<li>Generates Python ticker list</li></ul><p><strong>Deployment:</strong>
<li>Claude Code reads ticker list</li>
<li>Generates QuantConnect algorithm</li>
<li>Compiles and validates code</li>
<li>Deploys to paper trading</li></ul><p><strong>Live Trading (9:30 AM - 4:00 PM ET):</strong>
<li>Algorithm enters positions (equal weight)</li>
<li>Monitors 2% stop loss per stock</li>
<li>Liquidates all positions 15 min before close</li></ul><h3>Key Performance Metrics</h3><p><strong>Backtest Results (Sep 1 - Oct 6, 2025):</strong>
<li><strong>Return:</strong> +11.92%</li>
<li><strong>Sharpe Ratio:</strong> 69.51% (Probabilistic)</li>
<li><strong>Trading Volume:</strong> $5.46M</li>
<li><strong>Strategy:</strong> Intraday breakout with daily liquidation</li></ul><h3>What Makes This System Unique</h3><ul><li><strong>Fully Automated:</strong> Zero manual intervention from scan to execution</li>
<li><strong>AI-Assisted Development:</strong> Claude Code builds and validates workflows</li>
<li><strong>Template-First Approach:</strong> Leverages proven n8n patterns</li>
<li><strong>Multi-Layer Validation:</strong> Node validation → Workflow validation → Compilation</li>
<li><strong>Transparent Scoring:</strong> Clear, auditable stock selection logic</li></ul><p>---</p><h2>Technical Stack Summary</h2><p>| Component | Purpose | Key Feature |
|-----------|---------|-------------|
| <strong>n8n</strong> | Workflow automation | 2,500+ templates, visual builder |
| <strong>n8n MCP</strong> | Claude integration | Programmatic workflow control |
| <strong>Claude Code</strong> | Development assistant | Natural language workflow creation |
| <strong>EODHD API</strong> | Market data | Screener + real-time + historical |
| <strong>Notion</strong> | Data storage | BREAKOUT SCORES database |
| <strong>QuantConnect</strong> | Trading execution | Paper/live trading with LEAN engine |</p><p>---</p><h2>Lessons Learned</h2><h3>What Worked Well</h3><p>✅ <strong>Template Discovery:</strong> n8n's 2,500+ templates accelerated development
✅ <strong>MCP Integration:</strong> Claude's ability to create workflows from natural language
✅ <strong>Validation Layers:</strong> Caught errors before deployment
✅ <strong>Volume Surge Filter:</strong> Strong signal for breakout confirmation</p><h3>Challenges Overcome</h3><p>⚠️ <strong>API Limitations:</strong> Russell 3000 not available → Used screener filters instead
⚠️ <strong>Expression Format Errors:</strong> Needed <code>=</code> prefix for n8n expressions
⚠️ <strong>Workflow Complexity:</strong> Split-in-batches pattern for stock iteration
⚠️ <strong>Data Structure Variations:</strong> Array handling for API responses</p><p>---</p><h2>Next Steps</h2><ul><li><strong>Live Testing:</strong> Monitor real market conditions (Oct 6 market open)</li>
<li><strong>Performance Analytics:</strong> Track daily P&L and win rate</li>
<li><strong>Universe Optimization:</strong> Test different scoring weights</li>
<li><strong>Risk Management:</strong> Implement portfolio-level stops</li>
<li><strong>Continuous Improvement:</strong> Document operational learnings</li></ul><p>---</p><h2>Conclusion</h2><p>Building automated trading systems requires combining multiple specialized tools. By connecting n8n's workflow automation with Claude's AI capabilities and QuantConnect's execution platform, I created a system that:</p><ul><li><strong>Scans</strong> thousands of stocks daily</li>
<li><strong>Identifies</strong> high-probability breakout candidates</li>
<li><strong>Deploys</strong> trading algorithms automatically</li>
<li><strong>Executes</strong> with disciplined risk management</li></ul><p>The key insight: <strong>Automation isn't just about code—it's about orchestration.</strong> Each component does what it does best, connected through well-defined interfaces.</p><p>The future of algorithmic trading isn't just faster algorithms—it's smarter workflows.</p><p>---</p><h2>Resources</h2><ul><li><strong>n8n Documentation:</strong> https://docs.n8n.io/</li>
<li><strong>n8n MCP Server:</strong> https://github.com/n8n-io/mcp-server</li>
<li><strong>Claude Code:</strong> https://claude.ai/claude-code</li>
<li><strong>QuantConnect:</strong> https://www.quantconnect.com/</li></ul><p>---</p><p>*Educational purposes only. Past performance does not guarantee future results.*
</p>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>&copy; 2025 SL Mar</p>
            <p>AI for Maritime & Quant Finance</p>
            <p><a href="MC_mentions-legales.html" style="color: inherit; text-decoration: underline;">Mentions légales</a></p>
        </div>
    </footer>
</body>
</html>