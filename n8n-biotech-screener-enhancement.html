<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MC_n8n Biotech Screener Enhancement Plan - SL Mar R&D Notes">
    <title>MC_n8n Biotech Screener Enhancement Plan | SL Mar</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .article-content {
            max-width: 900px;
            margin: 0 auto;
        }
        .article-content h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        .article-content h2 {
            font-size: 1.75rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }
        .article-content h3 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .article-content p {
            margin-bottom: 1rem;
            line-height: 1.8;
        }
        .article-content ul, .article-content ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }
        .article-content li {
            margin-bottom: 0.5rem;
        }
        .article-content code {
            background: var(--bg-secondary);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .article-content pre {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        .article-content pre code {
            padding: 0;
            background: none;
        }
        .article-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        .article-content table td {
            padding: 0.5rem;
            border: 1px solid var(--border);
        }
        .back-link {
            display: inline-block;
            margin-bottom: 2rem;
            color: var(--accent);
        }
    </style>
</head>
<body>
    <nav>
        <div class="container">
            <a href="index.html" class="logo">SL Mar - Maritime and AI Consultancy</a>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="publications.html">Publications</a></li>
                <li><a href="development.html">Development</a></li>
                <li><a href="local-ai.html">Local AI</a></li>
                <li><a href="rnd-notes.html" class="active">R&D Notes</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </div>
    </nav>

    <section>
        <div class="container article-content">
            <a href="rnd-notes.html" class="back-link">← Back to R&D Notes</a>
            <h1>MC_n8n Biotech Screener Enhancement Plan</h1>
<strong>Date:</strong> October 9, 2025
<strong>Purpose:</strong> Modify existing n8n screener to catch speculative biotech micro-cap moves like Oct 8, 2025 gainers</p><h2>Problem Statement</h2><p><strong>Current Tech Breakout Flow (7 AM ET):</strong>
<li>Targets: Tech sector, $300M-$50B market cap</li>
<li>Criteria: 3x volume surge, technical scoring</li>
<li><strong>MISSED:</strong> All 7 biotech micro-cap gainers on Oct 8 (+52% to +141%)</li></ul><p><strong>Why Current Screener Failed:</strong>
<li><strong>Wrong Sector Filter:</strong> Tech only, excluded Biotech/Pharma</li>
<li><strong>Wrong Market Cap:</strong> $300M minimum, excluded micro-caps ($30M-$100M)</li>
<li><strong>Wrong Timing:</strong> 7 AM scan, missed pre-market momentum signals</li>
<li><strong>Wrong Data Source:</strong> EODHD may not cover micro-cap pre-market activity</li></ul><h2>Proposed Solution: Dual-Stream Screener</h2><h3>Stream 1: Tech Breakout Flow (Existing)</h3>
<strong>Keep as-is:</strong> Current workflow works for established tech companies
<li>Sector: Technology</li>
<li>Market Cap: $300M - $50B</li>
<li>Timing: 7 AM ET scan</li>
<li>Entry: After 10 AM ET</li></ul><h3>Stream 2: Biotech Speculative Flow (NEW)</h3>
<strong>Add parallel workflow for micro-cap biotech momentum</strong>
<li>Sector: Biotech/Pharma</li>
<li>Market Cap: $50M - $500M</li>
<li>Timing: 8 AM ET scan (catch pre-market)</li>
<li>Entry: Market open (9:30 AM ET)</li></ul><p>---</p><h2>n8n Workflow Design: Biotech Speculative Screener</h2><h3>Workflow Name: "MC_Biotech Micro-Cap Screener"</h3><h3>Architecture Overview</h3>
<pre><code>
[Schedule Trigger: 8:00 AM ET] → [Data Source: EODHD API or Alternative]
    ↓
[Filter 1: Universe Selection]
    ↓
[Filter 2: Volume Breakout Detection]
    ↓
[Filter 3: Technical Confirmation]
    ↓
[Filter 4: Risk Filters]
    ↓
[Scoring & Ranking]
    ↓
[Format Output] → [Store in Notion] → [Send Telegram Alert]
</code></pre><p>---</p><h2>Node-by-Node Implementation</h2><h3>Node 1: Schedule Trigger</h3>
<pre><code>json
{
  "node": "Schedule Trigger",
  "type": "n8n-nodes-base.scheduleTrigger",
  "typeVersion": 1.2,
  "position": [-800, 0],
  "parameters": {
    "rule": {
      "interval": [
        {
          "field": "cronExpression",
          "expression": "0 8 * * 1-5"
        }
      ]
    },
    "timezone": "America/New_York"
  },
  "name": "Daily 8AM ET"
}
</code></pre><h3>Node 2: EODHD API - Universe Selection</h3>
<strong>CRITICAL ISSUE:</strong> EODHD MCP currently unavailable. Need alternative:</p><p><strong>Option A: Use Finnhub API (Free Tier)</strong>
<li>Supports stock screener endpoint</li>
<li>Micro-cap coverage</li>
<li>Pre-market data available</li></ul><p><strong>Option B: Use Polygon.io API</strong>
<li>Better micro-cap coverage</li>
<li>Real-time pre-market data</li>
<li>Requires paid tier ($99/mo)</li></ul><p><strong>Option C: Use Yahoo Finance via HTTP Request</strong>
<li>Free, no API key needed</li>
<li>Limited to batch ticker lookup</li>
<li>No native screener endpoint</li></ul><p><strong>RECOMMENDED: Polygon.io</strong> (best for micro-cap coverage)</p><pre><code>json
{
  "node": "Polygon Screener API",
  "type": "n8n-nodes-base.httpRequest",
  "parameters": {
    "method": "GET",
    "url": "https://api.polygon.io/v3/snapshot/tickers",
    "authentication": "predefinedCredentialType",
    "nodeCredentialType": "polygonApi",
    "qs": {
      "market_type": "stocks",
      "order": "desc",
      "sort": "volume",
      "limit": "500"
    },
    "options": {
      "timeout": 30000
    }
  }
}
</code></pre><h3>Node 3: Filter - Universe Selection</h3>
<pre><code>javascript
// Code Node: Filter Universe
const minMarketCap = 50000000;  // $50M
const maxMarketCap = 500000000; // $500M
const minVolume = 100000;       // 100K shares
const sectors = ['Healthcare', 'Biotechnology', 'Pharmaceuticals'];</p><p>const filtered = items[0].json.results.filter(stock => {
<table>
<tr><td></td></tr>
<tr><td></td></tr>
<tr><td></td></tr>
</table><p>  return (
    marketCap >= minMarketCap &&
    marketCap <= maxMarketCap &&
    volume >= minVolume &&
    sectors.includes(sector) &&
<table>
<tr><td></td></tr>
</table>
  );
});</p><p>return filtered.map(stock => ({ json: stock }));
</code></pre><h3>Node 4: Volume Breakout Detection</h3>
<strong>CHALLENGE:</strong> Need historical volume data (50-day average)</p><p><strong>Solution:</strong> Use Polygon Historical Aggregates endpoint</p><p>``<code>javascript
// Code Node: Calculate Volume Ratio
// For each ticker, fetch 50-day average volume
const ticker = $json.ticker;
const currentVolume = $json.volume;</p><p>// Make API call to get 50-day avg (via Function Item node)
const historicalData = await this.helpers.httpRequest({
  method: 'GET',
  url: </code>https://api.polygon.io/v2/aggs/ticker/${ticker}/range/1/day/${startDate}/${endDate}<code>,
  qs: {
    apiKey: '{{$credentials.polygonApi.apiKey}}'
  }
});</p><p>const avgVolume = historicalData.results.reduce((sum, day) => sum + day.v, 0) / 50;
const volumeRatio = currentVolume / avgVolume;</p><p>return {
  ...item.json,
  avgVolume50Day: avgVolume,
  volumeRatio: volumeRatio,
  volumeBreakout: volumeRatio >= 3.0
};
<pre><code></p><h3>Node 5: Technical Indicators (RSI, Moving Averages)</h3>
<strong>Option 1:</strong> Calculate in Code Node
<strong>Option 2:</strong> Use Trading View API (if available)
<strong>Option 3:</strong> Use TaLib via Python (Function node)</p><p><strong>RECOMMENDED: Code Node with manual calculation</strong></p><p></code></pre>javascript
// Code Node: Calculate RSI(14)
function calculateRSI(prices, period = 14) {
  let gains = 0;
  let losses = 0;</p><p>  for (let i = 1; i <= period; i++) {
    const change = prices[i] - prices[i-1];
    if (change > 0) gains += change;
    else losses += Math.abs(change);
  }</p><p>  const avgGain = gains / period;
  const avgLoss = losses / period;
  const rs = avgGain / avgLoss;
  const rsi = 100 - (100 / (1 + rs));</p><p>  return rsi;
}</p><p>// Fetch 20-day price history for RSI calculation
const ticker = $json.ticker;
const priceData = await fetchPriceHistory(ticker, 20);
const rsi = calculateRSI(priceData);</p><p>// Calculate 20-day and 50-day MA
const ma20 = priceData.slice(-20).reduce((a,b) => a+b, 0) / 20;
const ma50 = priceData.slice(-50).reduce((a,b) => a+b, 0) / 50;</p><p>return {
  ...item.json,
  rsi: rsi,
  ma20: ma20,
  ma50: ma50,
  aboveMA20: $json.price > ma20,
  aboveMA50: $json.price > ma50,
  rsiInRange: rsi >= 60 && rsi <= 75
};
<pre><code></p><h3>Node 6: Technical Confirmation Filter</h3>
</code></pre>javascript
// Code Node: Apply Technical Filters
const candidates = items.filter(item => {
  const data = item.json;</p><p>  return (
    data.volumeBreakout === true &&        // 3x volume
    data.rsiInRange === true &&            // RSI 60-75
    data.aboveMA20 === true &&             // Price > 20-day MA
    data.aboveMA50 === true                // Price > 50-day MA
  );
});</p><p>return candidates;
<pre><code></p><h3>Node 7: Risk Filters</h3>
</code></pre>javascript
// Code Node: Exclude High-Risk Stocks
const safeStocks = items.filter(item => {
  const ticker = item.json.ticker;</p><p>  // Check for recent reverse splits (requires additional API call)
  // Check for delisting warnings
  // Check for bankruptcy filings</p><p>  // Placeholder: Implement risk checks here
  return true; // For now, pass all through
});</p><p>return safeStocks;
<pre><code></p><h3>Node 8: Scoring & Ranking</h3>
</code></pre>javascript
// Code Node: Calculate Composite Score
const scored = items.map(item => {
  const data = item.json;</p><p>  let score = 0;</p><p>  // Volume component (max 30 points)
  score += Math.min(data.volumeRatio / 10 * 30, 30);</p><p>  // RSI component (max 25 points)
  if (data.rsi >= 65 && data.rsi <= 70) score += 25;
  else if (data.rsi >= 60 && data.rsi < 65) score += 20;
  else if (data.rsi > 70 && data.rsi <= 75) score += 15;</p><p>  // Price action component (max 25 points)
  const aboveMA20Pct = (data.price - data.ma20) / data.ma20;
  const aboveMA50Pct = (data.price - data.ma50) / data.ma50;
  score += (aboveMA20Pct * 100 > 5) ? 15 : 10;
  score += (aboveMA50Pct * 100 > 10) ? 10 : 5;</p><p>  // Market cap component (max 20 points)
  // Prefer $50M-$150M range (highest volatility)
  if (data.market_cap >= 50000000 && data.market_cap <= 150000000) {
    score += 20;
  } else if (data.market_cap > 150000000 && data.market_cap <= 300000000) {
    score += 15;
  } else {
    score += 10;
  }</p><p>  return {
    json: {
      ...data,
      compositeScore: Math.round(score)
    }
  };
});</p><p>// Sort by score descending
scored.sort((a, b) => b.json.compositeScore - a.json.compositeScore);</p><p>// Take top 10
return scored.slice(0, 10);
<pre><code></p><h3>Node 9: Format Output</h3>
</code></pre>javascript
// Code Node: Format for Notion & Telegram
const output = items.map(item => {
  const data = item.json;</p><p>  return {
    json: {
      ticker: data.ticker,
      currentPrice: data.price.toFixed(2),
      marketCap: </code>$${(data.market_cap / 1000000).toFixed(1)}M<code>,
      volumeRatio: data.volumeRatio.toFixed(1) + 'x',
      rsi: data.rsi.toFixed(0),
      score: data.compositeScore,
      sector: data.sip_sector,
      priceAboveMA20: ((data.price - data.ma20) / data.ma20 * 100).toFixed(1) + '%',
      priceAboveMA50: ((data.price - data.ma50) / data.ma50 * 100).toFixed(1) + '%',
      analysisDate: new Date().toISOString().split('T')[0],
      catalyst: 'No specific catalyst - Monitor pre-market'
    }
  };
});</p><p>return output;
<pre><code></p><h3>Node 10: Create Notion Database Entries</h3>
</code></pre>json
{
  "node": "Notion - Create Pages",
  "type": "n8n-nodes-base.notion",
  "parameters": {
    "resource": "databasePage",
    "operation": "create",
    "databaseId": "2872383a-2386-81f9-a9b7-f9c3d2dd221c",
    "title": "={{$json.ticker}}",
    "properties": {
      "Ticker": "={{$json.ticker}}",
      "Market Cap": "={{$json.marketCap}}",
      "Sector": "={{$json.sector}}",
      "Volume Ratio": "={{$json.volumeRatio}}",
      "RSI": "={{$json.rsi}}",
      "Score": "={{$json.score}}",
      "Date": "={{$json.analysisDate}}",
      "Catalyst": "={{$json.catalyst}}",
      "Notes": "Volume breakout detected. Pre-market monitoring required."
    }
  }
}
<pre><code></p><h3>Node 11: Send Telegram Alert</h3>
</code></pre>json
{
  "node": "Telegram",
  "type": "n8n-nodes-base.telegram",
  "parameters": {
    "resource": "message",
    "operation": "sendMessage",
    "chatId": "8248011938",
<table>
<tr><td>RSI: ${item.rsi}</td></tr>
</table>
  }
}
<pre><code></p><p>---</p><h2>Critical Implementation Challenges</h2><h3>1. Data Source Availability</h3>
<strong>PROBLEM:</strong> EODHD MCP currently unavailable
<strong>SOLUTION:</strong>
<li>Short-term: Use Polygon.io API ($99/mo for real-time)</li>
<li>Long-term: Fix EODHD MCP or build custom scraper</li></ul><h3>2. Pre-Market Data Access</h3>
<strong>PROBLEM:</strong> Most APIs require paid tier for pre-market data
<strong>SOLUTION:</strong>
<li>Use Polygon.io (includes pre-market)</li>
<li>OR: Run screener at 9:35 AM ET (5 min after open) to catch immediate momentum</li></ul><h3>3. Historical Data for Technical Indicators</h3>
<strong>PROBLEM:</strong> Need 50-day price/volume history for each candidate
<strong>SOLUTION:</strong>
<li>Batch API calls (rate limiting risk)</li>
<li>Cache historical data in Notion/Database (refresh daily)</li>
<li>Use TaLib or similar library for efficient calculation</li></ul><h3>4. Micro-Cap Data Quality</h3>
<strong>PROBLEM:</strong> Many micro-caps have sparse/unreliable data
<strong>SOLUTION:</strong>
<li>Add minimum volume filter (100K shares)</li>
<li>Exclude OTC stocks</li>
<li>Manual review of top candidates before trading</li></ul><p>---</p><h2>Implementation Timeline</h2><h3>Week 1: Setup & Data Integration</h3>
<li>[ ] Choose data provider (Polygon.io recommended)</li>
<li>[ ] Set up API credentials in n8n</li>
<li>[ ] Test universe selection filter (500 stocks → 50 biotech micro-caps)</li>
<li>[ ] Validate market cap and sector filtering</li></ul><h3>Week 2: Technical Indicator Integration</h3>
<li>[ ] Implement volume ratio calculation (50-day average)</li>
<li>[ ] Implement RSI(14) calculation</li>
<li>[ ] Implement 20-day and 50-day MA calculation</li>
<li>[ ] Test with historical data (Oct 8 should return XBIO, NXL, etc.)</li></ul><h3>Week 3: Scoring & Output</h3>
<li>[ ] Implement composite scoring algorithm</li>
<li>[ ] Connect to "Gainers Analysis" Notion database</li>
<li>[ ] Set up Telegram notification workflow</li>
<li>[ ] Add error handling and logging</li></ul><h3>Week 4: Validation & Paper Trading</h3>
<li>[ ] Run screener daily for 2 weeks (paper trading)</li>
<li>[ ] Track false positive rate</li>
<li>[ ] Track hit rate (stocks that gain >20% intraday)</li>
<li>[ ] Refine scoring weights based on results</li></ul><p>---</p><h2>Success Metrics</h2><h3>Validation Criteria (Paper Trading Phase)</h3>
<li><strong>Hit Rate:</strong> >40% of candidates gain >20% within 1-5 days</li>
<li><strong>False Positive Rate:</strong> <60% (acceptable for speculative strategy)</li>
<li><strong>Average Gain (winners):</strong> >50%</li>
<li><strong>Average Loss (losers):</strong> <15%</li>
<li><strong>Risk-Reward Ratio:</strong> >3:1</li></ul><h3>Example Test Case: October 8, 2025</h3>
<strong>Expected Output:</strong> Should return at least 3 of the 7 top gainers (XBIO, NXL, ATON)
<li>XBIO: Volume 552x, RSI 89, Score: 85+</li>
<li>NXL: Volume 0.75x, RSI 84, Score: 70+</li>
<li>ATON: Volume N/A, RSI 74, Score: 65+</li></ul><p><strong>If screener fails this test:</strong> Adjust filters until it passes</p><p>---</p><h2>Risk Management Integration</h2><h3>Position Sizing (QC Algorithm Integration)</h3>
</code></pre>python
<h1>In QuantConnect algorithm</h1>
self.max_position_size = 1000  # $1,000 per position (same as current)
self.max_biotech_exposure = 0.10  # Max 10% of portfolio in biotech micro-caps
self.stop_loss_pct = 0.15  # 15% stop loss (vs 1% for tech)
self.profit_target_pct = 0.30  # 30% profit target (vs 5% for tech)
</code>``</p><h3>Entry Rules</h3>
<li><strong>Only trade top 3-5 candidates</strong> from daily screener</li>
<li><strong>Must show pre-market momentum</strong> (>5% gap up)</li>
<li><strong>Enter at market open OR first pullback</strong> (9:30-9:45 AM)</li>
<li><strong>Maximum 2 positions per day</strong> (limit exposure)</li></ul><h3>Exit Rules</h3>
<li><strong>Stop Loss:</strong> Exit if down 15% from entry</li>
<li><strong>Profit Target:</strong> Exit 50% at +30%, let rest run to +50%</li>
<li><strong>Time Exit:</strong> Close all positions by 3:55 PM (no overnight)</li>
<li><strong>News Exit:</strong> Exit immediately if negative news breaks</li></ul><p>---</p><h2>Comparison: Tech Flow vs Biotech Flow</h2><table>
<tr><td>Feature</td><td>Tech Breakout Flow</td><td>Biotech Speculative Flow</td></tr>
<tr><td><strong>Sector</strong></td><td>Technology</td><td>Biotech/Pharma</td></tr>
<tr><td><strong>Market Cap</strong></td><td>$300M - $50B</td><td>$50M - $500M</td></tr>
<tr><td><strong>Scan Time</strong></td><td>7:00 AM ET</td><td>8:00 AM ET</td></tr>
<tr><td><strong>Data Source</strong></td><td>EODHD Screener</td><td>Polygon.io API</td></tr>
<tr><td><strong>Volume Filter</strong></td><td>3x surge</td><td>3x surge (same)</td></tr>
<tr><td><strong>RSI Range</strong></td><td>Not specified</td><td>60-75 (momentum building)</td></tr>
<tr><td><strong>Entry Time</strong></td><td>After 10:00 AM</td><td>9:30 AM (market open)</td></tr>
<tr><td><strong>Stop Loss</strong></td><td>1%</td><td>15%</td></tr>
<tr><td><strong>Profit Target</strong></td><td>5%</td><td>30-50%</td></tr>
<tr><td><strong>Position Size</strong></td><td>$1,000</td><td>$1,000</td></tr>
<tr><td><strong>Max Exposure</strong></td><td>100% of algo</td><td>10% of algo</td></tr>
<tr><td><strong>Catalyst Required</strong></td><td>Volume surge</td><td>None (speculative)</td></tr>
<tr><td><strong>Risk Level</strong></td><td>Low-Medium</td><td>High</td></tr>
</table><p>---</p><h2>Next Steps</h2><h3>Immediate Actions (This Week)</h3>
<li><strong>User Decision:</strong> Approve Polygon.io subscription ($99/mo) OR use free alternative (Yahoo Finance)</li>
<li><strong>Create n8n Workflow:</strong> Build "MC_Biotech Micro-Cap Screener" workflow in n8n</li>
<li><strong>Test with Historical Data:</strong> Validate that Oct 8 gainers would have been detected</li></ul><h3>Short-Term (Next 2 Weeks)</h3>
<li><strong>Paper Trade:</strong> Run screener daily, track results in Notion</li>
<li><strong>Refine Scoring:</strong> Adjust weights based on false positives/negatives</li>
<li><strong>Manual Review Process:</strong> Establish criteria for which candidates to trade</li></ul><h3>Long-Term (Next Month)</h3>
<li><strong>Live Trading Integration:</strong> Connect to QuantConnect breakout algo</li>
<li><strong>Performance Monitoring:</strong> Track separately from tech breakout flow</li>
<li><strong>Strategy Refinement:</strong> Kill or scale based on results</li></ul><p>---</p><h2>Conclusion</h2><p><strong>The current tech breakout screener cannot catch biotech micro-cap speculative moves</strong> due to:
<li>Wrong sector filter (Tech only)</li>
<li>Wrong market cap filter (too high)</li>
<li>Wrong timing (misses pre-market momentum)</li>
<li>Data source limitations (EODHD MCP unavailable)</li></ul><p><strong>Proposed solution: Add parallel "Biotech Speculative Flow"</strong> with:
<li>Separate n8n workflow (8 AM ET)</li>
<li>Micro-cap focus ($50M-$500M)</li>
<li>Pre-market momentum detection</li>
<li>Higher risk/reward parameters (15% stop, 30-50% target)</li>
<li>Limited portfolio exposure (10% max)</li></ul><p><strong>Success requires:</strong>
<li>Reliable micro-cap data source (Polygon.io recommended)</li>
<li>Daily paper trading validation (2+ weeks)</li>
<li>Strict risk management (small positions, wide stops)</li>
<li>Acceptance of 40-60% hit rate offset by 50%+ winners</li></ul><p><strong>Recommendation:</strong> Build and paper trade before live deployment. Only go live if hit rate >40% and risk-reward >3:1.</p><p>---</p><p><strong>Status:</strong> Implementation plan ready for review
<strong>Next Step:</strong> User approval on data source (Polygon.io vs free alternative)
<strong>Author:</strong> Claude Code (MC_ prefix indicates machine-created draft)
</p>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>&copy; 2025 SL Mar</p>
            <p>AI for Quantitative Finance and Maritime Applications</p>
            <p>France • SIRET 98770400400017</p>
        </div>
    </footer>
</body>
</html>