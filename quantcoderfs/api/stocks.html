<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stocks API - QuantCoderFS Documentation</title>
    <link rel="stylesheet" href="../assets/css/docs.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="docs-header">
        <div class="docs-header-content">
            <a href="../docs.html" class="docs-logo">
                <i class="fas fa-chart-line"></i>
                <span>QuantCoderFS</span>
            </a>
            <nav>
                <ul class="docs-nav">
                    <li><a href="../docs.html">Documentation</a></li>
                    <li><a href="https://github.com/SL-Mar/quantcoderfs" target="_blank"><i class="fab fa-github"></i> GitHub</a></li>
                </ul>
            </nav>
            <a href="../../index.html" class="back-to-main"><i class="fas fa-arrow-left"></i> Back to Main Site</a>
        </div>
    </header>

    <div class="docs-container">
        <aside class="docs-sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Getting Started</div>
                <ul class="sidebar-menu">
                    <li><a href="../docs.html"><i class="fas fa-home"></i> Overview</a></li>
                    <li><a href="../docs.html#installation"><i class="fas fa-download"></i> Installation</a></li>
                    <li><a href="../docs.html#architecture"><i class="fas fa-sitemap"></i> Architecture</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">System Components</div>
                <ul class="sidebar-menu">
                    <li><a href="../docs.html#market-intelligence"><i class="fas fa-robot"></i> Market Intelligence</a></li>
                    <li><a href="../docs.html#strategy-generator"><i class="fas fa-code"></i> Strategy Generator</a></li>
                    <li><a href="../docs.html#dependencies"><i class="fas fa-cubes"></i> Dependencies</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">API Reference</div>
                <ul class="sidebar-menu">
                    <li><a href="stocks.html" class="active"><i class="fas fa-chart-bar"></i> Stocks API</a></li>
                    <li><a href="signals.html"><i class="fas fa-lightbulb"></i> Signals API</a></li>
                    <li><a href="settings.html"><i class="fas fa-cog"></i> Settings API</a></li>
                    <li><a href="research.html"><i class="fas fa-microscope"></i> Research API</a></li>
                    <li><a href="../docs.html#api-strategies"><i class="fas fa-file-code"></i> Strategies API</a></li>
                    <li><a href="../docs.html#api-backtest"><i class="fas fa-rocket"></i> Backtest API</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Advanced Topics</div>
                <ul class="sidebar-menu">
                    <li><a href="../docs.html#agents"><i class="fas fa-robot"></i> Agentic Frameworks</a></li>
                    <li><a href="../docs.html#llm-providers"><i class="fas fa-brain"></i> LLM Providers</a></li>
                    <li><a href="../docs.html#database"><i class="fas fa-table"></i> Database Schema</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Resources</div>
                <ul class="sidebar-menu">
                    <li><a href="https://github.com/SL-Mar/quantcoderfs" target="_blank"><i class="fab fa-github"></i> GitHub</a></li>
                    <li><a href="https://arxiv.org/abs/2401.03737" target="_blank"><i class="fas fa-file-pdf"></i> MarketSense AI Paper</a></li>
                </ul>
            </div>
        </aside>

        <main class="docs-main">
            <div class="docs-content">
                <h1>Stocks API</h1>
                <p class="docs-subtitle">Manage stock snapshots and retrieve market data from EODHD API</p>

                <div class="info-box info-box-note">
                    <div class="info-box-title">
                        <i class="fas fa-info-circle"></i>
                        Last Updated
                    </div>
                    <p>16 Oct 2025 - Current Implementation</p>
                </div>

                <h2>Overview</h2>
                <p>The Stocks API provides endpoints for creating and managing stock data snapshots. Each snapshot represents a point-in-time capture of:</p>
                <ul>
                    <li><strong>End-of-Day (EOD) Pricing</strong> - Historical OHLCV price data</li>
                    <li><strong>Fundamentals</strong> - Financial statements, ratios, and key metrics</li>
                    <li><strong>Company News</strong> - Latest news articles</li>
                    <li><strong>Technical Indicators</strong> - Pre-calculated indicators</li>
                </ul>

                <h2>Snapshot Architecture</h2>
                <div class="info-box info-box-success">
                    <div class="info-box-title">
                        <i class="fas fa-camera"></i>
                        Understanding Snapshots
                    </div>
                    <p>QuantCoderFS uses a <strong>snapshot-based architecture</strong> to track stock data over time:</p>
                    <ul>
                        <li><strong>Snapshot ID Format:</strong> <code>YYYYMMDD_HHMMSS</code> (e.g., <code>20251016_143022</code>)</li>
                        <li><strong>Multiple Snapshots:</strong> Each ticker can have multiple snapshots taken at different times</li>
                        <li><strong>Independent Data:</strong> Each snapshot contains its own EOD data, fundamentals, news, and analysis</li>
                        <li><strong>File Storage:</strong> Data is stored in <code>/stocks/{ticker}/{snapshot_id}/</code></li>
                        <li><strong>Versioning:</strong> Track how market conditions and analysis change over time</li>
                    </ul>
                    <p><strong>Legacy Format:</strong> The old <code>project_id</code> format (<code>ticker_timestamp</code>) is still supported but deprecated.</p>
                </div>

                <h2>Core Endpoints</h2>

                <!-- Create Stock Snapshot -->
                <div class="api-endpoint">
                    <div>
                        <span class="api-method method-post">POST</span>
                        <span class="api-path">/api/stocks/create</span>
                    </div>
                    <p class="api-description">Create a new stock snapshot and fetch data from EODHD API.</p>

                    <div class="api-section">
                        <h4 class="api-section-title">Request Body</h4>
                        <pre><code>{
  "ticker": "AAPL.US",
  "lookback_years": 1,
  "period": "1d",
  "limit": 250
}</code></pre>
                    </div>

                    <div class="api-section">
                        <h4 class="api-section-title">Request Parameters</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Field</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>ticker</code></td>
                                    <td>string</td>
                                    <td>Yes</td>
                                    <td>Stock ticker symbol (e.g., "AAPL.US")</td>
                                </tr>
                                <tr>
                                    <td><code>lookback_years</code></td>
                                    <td>integer</td>
                                    <td>No</td>
                                    <td>Years of historical data (default: 1)</td>
                                </tr>
                                <tr>
                                    <td><code>period</code></td>
                                    <td>string</td>
                                    <td>No</td>
                                    <td>Granularity: '1m', '5m', '1h', '1d', '1w', '1M' (default: '1d')</td>
                                </tr>
                                <tr>
                                    <td><code>limit</code></td>
                                    <td>integer</td>
                                    <td>No</td>
                                    <td>Number of candles to fetch (default: 250)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="api-section">
                        <h4 class="api-section-title">Example Request (cURL)</h4>
                        <pre><code>curl -X POST "http://localhost:8004/api/stocks/create" \
  -H "Content-Type: application/json" \
  -d '{
    "ticker": "AAPL.US",
    "lookback_years": 1,
    "period": "1d",
    "limit": 250
  }'</code></pre>
                    </div>

                    <div class="api-section">
                        <h4 class="api-section-title">Example Request (Python)</h4>
                        <pre><code>import requests

response = requests.post(
    "http://localhost:8004/api/stocks/create",
    json={
        "ticker": "AAPL.US",
        "lookback_years": 1,
        "period": "1d",
        "limit": 250
    }
)

data = response.json()
print(f"Snapshot ID: {data['snapshot_id']}")</code></pre>
                    </div>

                    <div class="api-section">
                        <h4 class="api-section-title">Response (201 Created)</h4>
                        <pre><code>{
  "ticker": "AAPL.US",
  "snapshot_id": "20251016_143022",
  "stock": {
    "ticker": "AAPL.US",
    "eod_data": {
      "code": "AAPL.US",
      "data": [
        {
          "code": "AAPL.US",
          "exchange_short_name": "NASDAQ",
          "data": [
            {
              "date": "2025-10-15",
              "open": 184.20,
              "high": 186.50,
              "low": 183.80,
              "close": 185.45,
              "adjusted_close": 185.45,
              "volume": 52341000
            }
          ]
        }
      ]
    },
    "fundamentals": {
      "General": {
        "Code": "AAPL",
        "Type": "Common Stock",
        "Name": "Apple Inc",
        "Exchange": "NASDAQ",
        "Sector": "Technology",
        "Industry": "Consumer Electronics"
      },
      "Highlights": {
        "MarketCapitalization": 2850000000000,
        "PERatio": 28.5,
        "DividendYield": 0.0052
      }
    },
    "news": {
      "articles": [
        {
          "date": "2025-10-15",
          "title": "Apple Announces New Product Line",
          "content": "...",
          "sentiment": {
            "polarity": 0.65,
            "neg": 0.1,
            "neu": 0.3,
            "pos": 0.6
          }
        }
      ]
    }
  }
}</code></pre>
                    </div>
                </div>

                <!-- List Tickers -->
                <div class="api-endpoint">
                    <div>
                        <span class="api-method method-get">GET</span>
                        <span class="api-path">/api/stocks/tickers</span>
                    </div>
                    <p class="api-description">List all tickers that have stock data.</p>

                    <div class="api-section">
                        <h4 class="api-section-title">Example Request</h4>
                        <pre><code>curl "http://localhost:8004/api/stocks/tickers"</code></pre>
                    </div>

                    <div class="api-section">
                        <h4 class="api-section-title">Response (200 OK)</h4>
                        <pre><code>["AAPL.US", "MSFT.US", "GOOGL.US", "TSLA.US"]</code></pre>
                    </div>
                </div>

                <!-- List Snapshots -->
                <div class="api-endpoint">
                    <div>
                        <span class="api-method method-get">GET</span>
                        <span class="api-path">/api/stocks/{ticker}/snapshots</span>
                    </div>
                    <p class="api-description">List all snapshots for a specific ticker.</p>

                    <div class="api-section">
                        <h4 class="api-section-title">Example Request</h4>
                        <pre><code>curl "http://localhost:8004/api/stocks/AAPL.US/snapshots"</code></pre>
                    </div>

                    <div class="api-section">
                        <h4 class="api-section-title">Response (200 OK)</h4>
                        <pre><code>[
  {
    "snapshot_id": "20251016_143022",
    "created_at": "2025-10-16T14:30:22Z",
    "size_mb": 2.5,
    "has_eod": true,
    "has_fundamentals": true,
    "has_news": true
  },
  {
    "snapshot_id": "20251015_091500",
    "created_at": "2025-10-15T09:15:00Z",
    "size_mb": 2.4,
    "has_eod": true,
    "has_fundamentals": true,
    "has_news": true
  }
]</code></pre>
                    </div>
                </div>

                <!-- Load Snapshot -->
                <div class="api-endpoint">
                    <div>
                        <span class="api-method method-get">GET</span>
                        <span class="api-path">/api/stocks/{ticker}/snapshots/{snapshot_id}</span>
                    </div>
                    <p class="api-description">Load a specific snapshot with all data.</p>

                    <div class="api-section">
                        <h4 class="api-section-title">Path Parameters</h4>
                        <ul class="api-params">
                            <li class="api-param">
                                <div>
                                    <span class="param-name">ticker</span>
                                    <span class="param-type">string</span>
                                    <span class="param-required">required</span>
                                </div>
                                <div class="param-description">Stock ticker symbol (e.g., "AAPL.US")</div>
                            </li>
                            <li class="api-param">
                                <div>
                                    <span class="param-name">snapshot_id</span>
                                    <span class="param-type">string</span>
                                    <span class="param-required">required</span>
                                </div>
                                <div class="param-description">Snapshot ID (format: YYYYMMDD_HHMMSS)</div>
                            </li>
                        </ul>
                    </div>

                    <div class="api-section">
                        <h4 class="api-section-title">Example Request</h4>
                        <pre><code>curl "http://localhost:8004/api/stocks/AAPL.US/snapshots/20251016_143022"</code></pre>
                    </div>

                    <div class="api-section">
                        <h4 class="api-section-title">Response (200 OK)</h4>
                        <pre><code>{
  "ticker": "AAPL.US",
  "eod_data": { ... },
  "fundamentals": { ... },
  "news": { ... }
}</code></pre>
                    </div>

                    <div class="api-section">
                        <h4 class="api-section-title">Error Responses</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Status Code</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>404</td>
                                    <td>Snapshot not found for ticker/snapshot_id</td>
                                </tr>
                                <tr>
                                    <td>500</td>
                                    <td>Internal server error</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <h2>Data Management Endpoints</h2>

                <!-- Refresh Stock Data -->
                <div class="api-endpoint">
                    <div>
                        <span class="api-method method-post">POST</span>
                        <span class="api-path">/api/stocks/refresh</span>
                    </div>
                    <p class="api-description">Incrementally refresh stock data (fetch only missing EOD records, optionally refresh fundamentals/news).</p>

                    <div class="api-section">
                        <h4 class="api-section-title">Request Body</h4>
                        <pre><code>{
  "ticker": "AAPL.US",
  "refresh_fundamentals": true,
  "refresh_news": true
}</code></pre>
                    </div>

                    <div class="api-section">
                        <h4 class="api-section-title">Response (200 OK)</h4>
                        <pre><code>{
  "ticker": "AAPL.US",
  "eod_records_added": 5,
  "news_articles_added": 12,
  "fundamentals_refreshed": true,
  "errors": [],
  "stock": { ... }
}</code></pre>
                    </div>
                </div>

                <h2>File Storage Endpoints</h2>

                <!-- List Files -->
                <div class="api-endpoint">
                    <div>
                        <span class="api-method method-get">GET</span>
                        <span class="api-path">/api/stocks/{ticker}/files</span>
                    </div>
                    <p class="api-description">List all files available for a stock (directory structure with metadata).</p>

                    <div class="api-section">
                        <h4 class="api-section-title">Response (200 OK)</h4>
                        <pre><code>{
  "ticker": "AAPL.US",
  "data_files": [
    {
      "filename": "eod_prices.csv",
      "size_kb": 52.3,
      "modified": 1697456789
    },
    {
      "filename": "fundamentals.json",
      "size_kb": 124.5,
      "modified": 1697456790
    },
    {
      "filename": "news.txt",
      "size_kb": 89.2,
      "modified": 1697456791
    }
  ],
  "snapshots": [
    {
      "snapshot_id": "20251016_143022",
      "size_mb": 2.5
    }
  ]
}</code></pre>
                    </div>
                </div>

                <!-- Download EOD CSV -->
                <div class="api-endpoint">
                    <div>
                        <span class="api-method method-get">GET</span>
                        <span class="api-path">/api/stocks/{ticker}/files/eod</span>
                    </div>
                    <p class="api-description">Download EOD prices CSV file.</p>

                    <div class="api-section">
                        <h4 class="api-section-title">Example Request</h4>
                        <pre><code>curl "http://localhost:8004/api/stocks/AAPL.US/files/eod" \
  --output aapl_eod_prices.csv</code></pre>
                    </div>

                    <div class="api-section">
                        <h4 class="api-section-title">Response (200 OK)</h4>
                        <p>Returns CSV file with headers:</p>
                        <pre><code>date,open,high,low,close,adjusted_close,volume
2024-10-16,184.20,186.50,183.80,185.45,185.45,52341000
...</code></pre>
                    </div>
                </div>

                <!-- Download Fundamentals JSON -->
                <div class="api-endpoint">
                    <div>
                        <span class="api-method method-get">GET</span>
                        <span class="api-path">/api/stocks/{ticker}/files/fundamentals</span>
                    </div>
                    <p class="api-description">Download fundamentals JSON file.</p>

                    <div class="api-section">
                        <h4 class="api-section-title">Example Request</h4>
                        <pre><code>curl "http://localhost:8004/api/stocks/AAPL.US/files/fundamentals" \
  --output aapl_fundamentals.json</code></pre>
                    </div>
                </div>

                <!-- Download News TXT -->
                <div class="api-endpoint">
                    <div>
                        <span class="api-method method-get">GET</span>
                        <span class="api-path">/api/stocks/{ticker}/files/news</span>
                    </div>
                    <p class="api-description">Download news articles TXT file (line-delimited JSON).</p>

                    <div class="api-section">
                        <h4 class="api-section-title">Example Request</h4>
                        <pre><code>curl "http://localhost:8004/api/stocks/AAPL.US/files/news" \
  --output aapl_news.txt</code></pre>
                    </div>
                </div>

                <!-- Get Metadata -->
                <div class="api-endpoint">
                    <div>
                        <span class="api-method method-get">GET</span>
                        <span class="api-path">/api/stocks/{ticker}/files/metadata</span>
                    </div>
                    <p class="api-description">Get metadata.json contents.</p>

                    <div class="api-section">
                        <h4 class="api-section-title">Response (200 OK)</h4>
                        <pre><code>{
  "ticker": "AAPL.US",
  "created_at": "2025-10-16T14:30:22Z",
  "lookback_years": 1,
  "period": "1d",
  "limit": 250,
  "eod_count": 252,
  "news_count": 50
}</code></pre>
                    </div>
                </div>

                <h2>Delete Endpoints</h2>

                <!-- Delete Snapshot -->
                <div class="api-endpoint">
                    <div>
                        <span class="api-method method-delete">DELETE</span>
                        <span class="api-path">/api/stocks/{ticker}/snapshots/{snapshot_id}</span>
                    </div>
                    <p class="api-description">Delete an entire snapshot (all data, analysis, research).</p>

                    <div class="api-section">
                        <h4 class="api-section-title">Example Request</h4>
                        <pre><code>curl -X DELETE \
  "http://localhost:8004/api/stocks/AAPL.US/snapshots/20251016_143022"</code></pre>
                    </div>

                    <div class="api-section">
                        <h4 class="api-section-title">Response (200 OK)</h4>
                        <pre><code>{
  "status": "deleted",
  "ticker": "AAPL.US",
  "snapshot_id": "20251016_143022"
}</code></pre>
                    </div>
                </div>

                <!-- Delete Ticker -->
                <div class="api-endpoint">
                    <div>
                        <span class="api-method method-delete">DELETE</span>
                        <span class="api-path">/api/stocks/{ticker}</span>
                    </div>
                    <p class="api-description">Delete entire ticker directory with all snapshots.</p>

                    <div class="api-section">
                        <h4 class="api-section-title">Example Request</h4>
                        <pre><code>curl -X DELETE "http://localhost:8004/api/stocks/AAPL.US"</code></pre>
                    </div>

                    <div class="api-section">
                        <h4 class="api-section-title">Response (200 OK)</h4>
                        <pre><code>{
  "status": "deleted",
  "ticker": "AAPL.US"
}</code></pre>
                    </div>
                </div>

                <h2>Legacy Endpoints (Deprecated)</h2>

                <div class="info-box info-box-warning">
                    <div class="info-box-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        Deprecated Endpoints
                    </div>
                    <p>The following endpoints are maintained for backward compatibility but should not be used in new code:</p>
                    <ul>
                        <li><code>GET /api/stocks/list</code> - Use <code>GET /api/stocks/tickers</code> instead</li>
                        <li><code>GET /api/stocks/load?project_id={ticker}_{timestamp}</code> - Use <code>GET /api/stocks/{ticker}/snapshots/{snapshot_id}</code> instead</li>
                    </ul>
                </div>

                <h2>Data Models</h2>

                <h3>Stock Model</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>ticker</code></td>
                            <td>string</td>
                            <td>Stock ticker symbol</td>
                        </tr>
                        <tr>
                            <td><code>eod_data</code></td>
                            <td>EODResult</td>
                            <td>Historical price data</td>
                        </tr>
                        <tr>
                            <td><code>fundamentals</code></td>
                            <td>StockFundamentals</td>
                            <td>Financial statements and ratios</td>
                        </tr>
                        <tr>
                            <td><code>news</code></td>
                            <td>NewsData</td>
                            <td>News articles with sentiment</td>
                        </tr>
                    </tbody>
                </table>

                <h3>EOD Price Record</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>date</code></td>
                            <td>date</td>
                            <td>Trading date</td>
                        </tr>
                        <tr>
                            <td><code>open</code></td>
                            <td>float</td>
                            <td>Opening price</td>
                        </tr>
                        <tr>
                            <td><code>high</code></td>
                            <td>float</td>
                            <td>High price</td>
                        </tr>
                        <tr>
                            <td><code>low</code></td>
                            <td>float</td>
                            <td>Low price</td>
                        </tr>
                        <tr>
                            <td><code>close</code></td>
                            <td>float</td>
                            <td>Closing price</td>
                        </tr>
                        <tr>
                            <td><code>volume</code></td>
                            <td>integer</td>
                            <td>Trading volume</td>
                        </tr>
                        <tr>
                            <td><code>adjusted_close</code></td>
                            <td>float</td>
                            <td>Adjusted closing price</td>
                        </tr>
                    </tbody>
                </table>

                <div class="info-box info-box-note">
                    <div class="info-box-title">
                        <i class="fas fa-info-circle"></i>
                        EODHD API Integration
                    </div>
                    <p>QuantCoderFS fetches data from <a href="https://eodhd.com" target="_blank">EODHD Financial APIs</a>. You need a valid API key configured in Settings. Free tier includes:</p>
                    <ul>
                        <li>20 years of historical EOD data</li>
                        <li>Fundamental data (financial statements, ratios)</li>
                        <li>Company news</li>
                        <li>100 API requests per day (free tier)</li>
                    </ul>
                </div>

                <h2>Error Responses</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Status Code</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>400</td>
                            <td>Invalid request (missing ticker, invalid format)</td>
                        </tr>
                        <tr>
                            <td>404</td>
                            <td>Stock/snapshot not found</td>
                        </tr>
                        <tr>
                            <td>500</td>
                            <td>Internal server error or EODHD API error</td>
                        </tr>
                    </tbody>
                </table>

                <h2>Next Steps</h2>
                <ul>
                    <li><a href="signals.html">Signals API</a> - Generate trading signals using stock snapshots</li>
                    <li><a href="research.html">Research API</a> - Generate comprehensive research reports</li>
                    <li><a href="settings.html">Settings API</a> - Configure API keys and credentials</li>
                    <li><a href="../docs.html#dependencies">Dependencies & Third-Party Services</a></li>
                </ul>
            </div>
        </main>
    </div>

    <footer class="docs-footer">
        <p>&copy; 2025 QuantCoderFS Documentation | Open Source Project | <a href="../../index.html">Back to Main Site</a></p>
    </footer>

    <script src="../assets/js/docs.js"></script>
</body>
</html>
